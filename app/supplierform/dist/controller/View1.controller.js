sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/core/BusyIndicator","sap/ui/model/json/JSONModel","sap/m/Dialog","sap/m/DialogType","sap/m/Button","sap/m/ButtonType","sap/m/Input","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/SimpleType","sap/ui/model/ValidateException","sap/m/MessageToast"],function(e,t,i,s,a,r,o,n,d,l,c,u,p,h){"use strict";return e.extend("sp.fiori.supplierform.controller.View1",{onInit:function(){sap.ui.getCore().getMessageManager().registerObject(this.getView(),true);this.router=sap.ui.core.UIComponent.getRouterFor(this);this.router.attachRouteMatched(this.handleRouteMatched,this);this.createModel=new s;this.getView().setModel(this.createModel,"create");var e=this.byId("MsmeValidFrom");e.addEventDelegate({onAfterRendering:()=>{e.$().find("INPUT").attr("disabled",true).css("color","#ccc")}},e);this.byId("MsmeValidTo").attachBrowserEvent("keypress",e=>e.preventDefault());this.hardcodedURL="";if(window.location.href.includes("launchpad")){this.hardcodedURL=window.location.href.split("/index")[0]}this.initializeCountries()},handleRouteMatched:function(e){if(e.getParameter("name")!=="RouteView1"){return}this.id=jQuery.sap.getUriParameters().get("id");var t=this.getView().getModel("request").getData();var s=this.getView().getModel("create").getData();s.VendorId=this.id;s.Vendor=t.Vendor;s.VendorType=t.VendorType;s.Companycode=t.Companycode;s.RegistrationType=t.RegistrationType;s.GroupType=t.GroupType.split(",");s.VDAAssessment=t.VDAAssessment;s.RelatedParty=false;s.AdditionalGst=false;s.SupplierType="Permanent";s.Purpose=t.Purpose;s.ReasonText=t.ReasonText;if(t.VendorType==="DM"){s.MsmeItilView="MSME";this.byId("msmeItil").setSelectedIndex(0)}if(t.VendorType==="DM"){s.GstApplicable="YES"}this.createModel.setData(s);this.createModel.refresh(true);this.vendorId=t.VendorId;var a={VendorId:t.VendorId,VendorType:t.VendorType,VendorName:t.VendorName,VendorMail:t.VendorMail,Telephone:t.Telephone};var r=JSON.stringify(a);var o=this.hardcodedURL+`/v2/odata/v4/catalog/VendorForm('${a.VendorId}')`;$.ajax({type:"GET",contentType:"application/json",url:o,context:this,success:function(e,s,a){let r=e.d;if(a.status===200||a.status===204){console.log("Data upserted successfully.")}if(t.VendorType==="DM"){if(!r.GstApplicable){r.GstApplicable="YES"}if(!r.MsmeValidTo){r.MsmeValidTo="99991231"}}if(!r.Type){r.Type="MATERIAL"}r.GroupType=r.GroupType.split(",");r.SupplierType="Permanent";r.Purpose=r.Purpose;r.ReasonText=r.ReasonText;if(!r.MsmeItilView&&t.VendorType==="DM"){r.MsmeItilView="MSME";this.byId("msmeItil").setSelectedIndex(0)}else if(r.MsmeItilView==="Non MSME"){this.byId("msmeItil").setSelectedIndex(1)}if(r.MsmeMainCertificate==="X"){this.byId("msmeCert").setSelected(true)}if(r.ISO9001Certification==="X"){this.byId("ISO9001Certification").setSelected(true)}if(r.IATF16949Certification==="X"){this.byId("IATF16949Certification").setSelected(true)}if(r.ISO14001Certification==="X"){this.byId("ISO14001Certification").setSelected(true)}if(r.ISO45001Certification==="X"){this.byId("ISO45001Certification").setSelected(true)}if(r.VDA63Certification==="X"){this.byId("VDA63Certification").setSelected(true)}if(r.MACEGreen==="X"){this.byId("MACEGreen").setSelected(true)}r.BeneficiaryName=t.VendorName;this.createModel.setData(r);this.createModel.refresh(true);if(r.Country){this.countryHelpSelect().then(()=>{var e=this.getView().byId("countryId").getSelectedKey();return this.loadStates(e,r.State_name,true)}).then(()=>{if(r.City){return this.loadCities(r.Country_code,r.State_name,r.City_name)}}).catch(e=>{console.error("Error in loading states/cities:",e)})}this._setRadioButtons(r);i.hide()}.bind(this),error:function(e,t,s){i.hide();console.log("Upsert failed: ",s)}});this._setRadioButtons(s);this._showRemainingTime()},onGetSupplierRegForm:function(){this.hardcodedURL="";if(window.location.href.includes("launchpad")){this.hardcodedURL=window.location.href.split("/index")[0]}var e=this.hardcodedURL+"/files/SupplierRegistrationfromupdated.doc";window.open(e,"_blank")},fetchProductInfo:function(){var e=this.getView().getModel("request").getData();var t=e.VendorId;this.getView().getModel().read("/ProductInfo",{success:e=>{var i=e.results.filter(function(e){return e.Vendor_VendorId===t});var s=this.productInfoTableModel.getData().rows;this.productInfoTableModel.setData({rows:s});for(var a=0;a<i.length&&a<s.length;a++){for(var r in i[a]){if(Object.prototype.hasOwnProperty.call(i[a],r)){s[a][r]=i[a][r]}}}this.productInfoTableModel.refresh(true)},error:e=>{console.log("Failed to fetch ProductInfo: ",e)}})},onGetSpareAttachment:function(e){i.show();setTimeout(()=>{this.getView().getModel().read("/CommonFile",{success:e=>{var t=e.results[0];var s=this.getView().getModel().sServiceUrl+"/CommonFile(fileid=1)/$value";window.open(s,"_blank");i.hide()},error:()=>i.hide()})},1e3)},_showRemainingTime:function(){var e=this;var i=this.getView().getModel("request").getData();try{var s=parseInt(i.VenValidTo.match(/\/Date\((\d+)\+\d+\)\//)[1]);var a=new Date(s);var r=new Date;var o=setInterval(function(){r=new Date;e.distance=a-r;var s=Math.floor(e.distance/(1e3*60*60*24));var n=Math.floor(e.distance%(1e3*60*60*24)/(1e3*60*60));var d=Math.floor(e.distance%(1e3*60*60)/(1e3*60));var l=Math.floor(e.distance%(1e3*60)/1e3);i.VenTimeLeft=` ${s} Days ${n} Hours ${d} Minutes ${l} Seconds`;e.getView().getModel("request").refresh(true);e.getView().byId("idRemTime").setText(i.VenTimeLeft);if(e.distance<0){clearInterval(o);i.VenTimeLeft="EXPIRED";e.getView().getModel("request").refresh(true);t.error("Form expired");e.getView().byId("saveBtnId").setVisible(false);e.getView().byId("submitBtnId").setVisible(false)}},1e3)}catch(e){console.error("Error in calculating remaining time: ",e)}},_setRadioButtons:function(e){if(e.VendorType==="IP"){this.byId("venTypeRbId").setSelectedIndex(1)}else if(e.VendorType==="EM"){this.byId("venTypeRbId").setSelectedIndex(2)}if(e.Type==="SERVICE"){this.byId("typeRbId").setSelectedIndex(1)}else if(e.Type==="BOTH"){this.byId("typeRbId").setSelectedIndex(2)}if(e.Companycode==="2000 SJ RUBBER INDUSTRIES LIMITED"){this.byId("companycodeRbId").setSelectedIndex(1)}else if(e.Companycode==="3000 IAI INDUSTRIES LIMITED"){this.byId("companycodeRbId").setSelectedIndex(2)}else if(e.Companycode==="4000 IMPERIAL MARTOR ENGINE TUBES PRIVATE LIMITED"){this.byId("companycodeRbId").setSelectedIndex(3)}if(e.RegistrationType==="Customer Driven (Export)"){this.byId("registrationtypeRbId").setSelectedIndex(1)}else if(e.RegistrationType==="BOM Parts"){this.byId("registrationtypeRbId").setSelectedIndex(2)}else if(e.RegistrationType==="Non BOM parts"){this.byId("registrationtypeRbId").setSelectedIndex(3)}if(e.Msme==="NO"){this.byId("msmeRbId").setSelectedIndex(1)}if(e.CaptivePower==="NO"){this.byId("captiveRbId").setSelectedIndex(1)}if(e.Union==="NO"){this.byId("unionRbId").setSelectedIndex(1)}if(e.ProdDesign==="NO"){this.byId("prodDesignRbId").setSelectedIndex(1)}if(e.SoftwareCapabilities==="NO"){this.byId("softwareCapRbId").setSelectedIndex(1)}else if(e.SoftwareCapabilities==="N/A"){this.byId("softwareCapRbId").setSelectedIndex(2)}if(e.BusinessContinuity==="NO"){this.byId("businessContinuityRbId").setSelectedIndex(1)}if(e.LogisticCustomer==="NO"){this.byId("logCustRbId").setSelectedIndex(1)}if(e.GstApplicable==="NO"){this.byId("gstRbId").setSelectedIndex(1)}if(e.WorkingTowardsCertifications==="Yes"){this.byId("workingTowardsCert").setSelectedIndex(0)}else if(e.WorkingTowardsCertifications==="No"){this.byId("workingTowardsCert").setSelectedIndex(1)}if(e.CentralExciseDutyApplicable==="YES"){this.byId("centralExciseDutyApplicableRbId").setSelectedIndex(0)}else if(e.CentralExciseDutyApplicable==="NO"){this.byId("centralExciseDutyApplicableRbId").setSelectedIndex(1)}},onVenNameChange:function(e){var t=this.createModel.getData();t.BeneficiaryName=e.getSource().getValue();this.createModel.refresh(true)},onRadioButtonSelect:function(e){var t=this.createModel.getData();var i=e.getParameter("id").substring(e.getParameter("id").lastIndexOf("-")+1);var s=e.getParameter("selectedIndex");switch(i){case"venTypeRbId":if(s===1){t.VendorType="IMPORT"}else if(s===2){t.VendorType="EMPLOYEE"}else{t.VendorType="DOMESTIC"}break;case"typeRbId":if(s===1){t.Type="SERVICE"}else if(s===2){t.Type="BOTH"}else{t.Type="MATERIAL"}break;case"unionRbId":if(s===1){t.Union="NO"}else{t.Union="YES"}break;case"gstRbId":if(s===1){t.GstApplicable="NO"}else{t.GstApplicable="YES"}break;case"msmeItil":if(s===0){t.MsmeItilView="MSME"}else{t.MsmeItilView="Non MSME"}break;case"workingTowardsCert":if(s===0){t.WorkingTowardsCertifications="Yes"}else{t.WorkingTowardsCertifications="No"}break;case"centralExciseDutyApplicableRbId":if(s===0){this.createModel.setProperty("/CentralExciseDutyApplicable","YES")}else{this.createModel.setProperty("/CentralExciseDutyApplicable","NO")}break;case"companycodeRbId":if(s===0){t.Companycode="1000 IMPERIAL AUTO INDUSTRIES LIMITED"}else if(s===1){t.Companycode="2000 SJ RUBBER INDUSTRIES LIMITED"}else if(s===2){t.Companycode="3000 IAI INDUSTRIES LIMITED"}else{t.Companycode="4000 IMPERIAL MARTOR ENGINE TUBES PRIVATE LIMITED"}break;case"registrationtypeRbId":if(s===0){t.RegistrationType="Customer Driven (Domestic)"}else if(s===1){t.RegistrationType="Customer Driven (Export)"}else if(s===2){t.RegistrationType="BOM Parts"}else{t.RegistrationType="Non BOM parts"}break;case"captiveRbId":if(s===0){t.CaptivePower="Yes"}else{t.CaptivePower="No"}break;case"prodDesignRbId":if(s===1){t.ProdDesign="NO"}else{t.ProdDesign="YES"}break;case"softwareCapRbId":if(s===1){t.SoftwareCapabilities="NO"}else if(s===2){t.SoftwareCapabilities="N/A"}else{t.SoftwareCapabilities="YES"}break;case"businessContinuityRbId":if(s===1){t.BusinessContinuity="NO"}else{t.BusinessContinuity="YES"}break;case"logCustRbId":if(s===1){t.LogisticCustomer="NO"}else{t.LogisticCustomer="YES"}break}this.createModel.refresh(true)},_mandatCheck:async function(){var e=this.createModel.getData();var t=this.getView(),i=false;var s=[t.byId("venNameId"),t.byId("mobileId"),t.byId("address1Id"),t.byId("accNoId"),t.byId("bankNameId"),t.byId("ifscId"),t.byId("branchNameId"),t.byId("benNameId"),t.byId("benLocId"),t.byId("address2Id"),t.byId("pincodeId")];if(e.GstApplicable==="YES"){s.push(t.byId("gstId"));var a=this.getView().getModel();var r=e.GstNumber}var o=[t.byId("countryId"),t.byId("stateId"),t.byId("cityId"),t.byId("benAccTypeId"),t.byId("bankstateId"),t.byId("suppliertypeId"),t.byId("grouptypeId")];if(e.RelatedParty===true){s.push(t.byId("RelatedPartyNameId"));s.push(t.byId("RelatedPartyDesigId"));s.push(t.byId("RelatedPartyContactId"))}if(e.MsmeItilView==="MSME"){s.push(t.byId("MsmeCertificateNo"));s.push(t.byId("MsmeValidFrom"));s.push(t.byId("MsmeRegistrationCity"));o.push(t.byId("MsmeCertificateId"))}if(e.VendorType==="IP"){o.push(t.byId("currId"))}if(e.VendorType==="DM"||e.VendorType==="EM"){s.push(t.byId("panId"))}s.forEach(function(e){i=this._validateInput(e)||i},this);o.forEach(function(e){i=this._validateSelect(e,i)||i},this);i=this._validateAttachments(i);if(e.MsmeItilView==="MSME"&&!t.byId("msmeCert").getSelected()){t.byId("msmeCert").setValueState("Error");i=true}return i},_validateInput:function(e){var t,i=e.getBinding("value");try{i.getType().validateValue(e.getValue());e.setValueState("None");t=false}catch(i){e.setValueState("Error");t=true}return t},initializeCountries:function(){console.log("Country initialization");var e=this.getView().byId("countryId");if(!e.getModel("countries")){this.loadCountries()}},loadCountries:function(){var e=this.getView().byId("countryId");var t=this.getOwnerComponent().getModel();var i="/Country";t.read(i,{success:function(t){var i=new sap.ui.model.json.JSONModel;i.setData({Countries:t.results});e.setModel(i,"countries");e.bindItems({path:"countries>/Countries",template:new sap.ui.core.Item({key:"{countries>code}",text:"{countries>code}"})})},error:function(e){console.log("Error",e)}})},countryHelpSelect:function(){return new Promise((e,t)=>{var i=this.getView().byId("stateId");var s=this.getView().byId("countryId").getSelectedKey();if(s){this.loadStates(s).then(e).catch(t)}else{i.setEnabled(false);e()}})},loadStates:function(e,t,i){var s=this;return new Promise(function(a,r){var o=s.byId("stateId"),n=s.byId("bankstateId");var d=s.getOwnerComponent().getModel();var l="/States";d.read(l,{urlParameters:{country:e},success:function(e){var s=new sap.ui.model.json.JSONModel;s.setData({States:e.results});o.setModel(s,"states");o.bindItems({path:"states>/States",template:new sap.ui.core.Item({key:"{states>name}",text:"{states>name}"})});n.setModel(s,"states");n.bindItems({path:"states>/States",template:new sap.ui.core.Item({key:"{states>name}",text:"{states>name}"})});if(i){setTimeout(()=>{if(t){o.setSelectedKey(t)}a()},1e3)}else{if(t){o.setSelectedKey(t)}a()}},error:function(e){console.log("Error",e);r(e)}})})},handleStatePress:function(){var e=this.getView().byId("stateId");var t=this.createModel.getData();if(e.getSelectedKey()){var i=this.getView().byId("countryId").getSelectedKey();var s=e.getSelectedKey();if(i==="India"){if(s==="Haryana"){t.Location="Within State"}else{t.Location="Outside State"}}else{t.Location="Outside Country"}this.loadCities(i,s)}else{h.show("Please select a state first.")}this.createModel.refresh(true)},loadCities:function(e,t,i){return new Promise((s,a)=>{var r=this.getView().byId("cityId");var o=this.getOwnerComponent().getModel();var n="/City";o.read(n,{urlParameters:{country:e,state:t},success:function(e){var t=new sap.ui.model.json.JSONModel;t.setData({Cities:e.results});r.setModel(t,"cities");r.bindItems({path:"cities>/Cities",template:new sap.ui.core.Item({key:"{cities>name}",text:"{cities>name}"})});if(i){r.setSelectedKey(i)}s()},error:function(e){console.log("Error",e);a(e)}})})},_validateSelect:function(e,t){var i="None";var s=e.getMetadata().getName()==="sap.m.MultiComboBox"?e.getSelectedKeys():e.getSelectedKey();try{if(!s){oBinding.getType().validateValue(e.getValue())}}catch(e){i="Error";t=true}e.setValueState(i);return t},_validateAttachments:function(e){var t=this.createModel.getData();if(t.VendorType==="IP"||t.VendorType==="EM"||t.MsmeItilView==="Non MSME"||this.byId("msmefileUploader").getValue()||t.MsmeDeclarationName){this.byId("msmefileUploader").setValueState("None")}else{e=true;this.byId("msmefileUploader").setValueState("Error")}if(t.VendorType==="DM"||t.VendorType==="EM"){if(this.byId("panfileUploader").getValue()||t.PanName){this.byId("panfileUploader").setValueState("None")}else{e=true;this.byId("panfileUploader").setValueState("Error")}}if(t.GstApplicable==="YES"){if(this.byId("gstfileUploader").getValue()||t.GstFileName){this.byId("gstfileUploader").setValueState("None")}else{e=true;this.byId("gstfileUploader").setValueState("Error")}}if(t.ISO9001Certification!=="X"){if(this.byId("IATFfileUploader").getValue()||t.IATFAttachment){this.byId("IATFfileUploader").setValueState("None")}else{e=true;this.byId("IATFfileUploader").setValueState("Error")}}if(this.byId("canChqfileUploader").getValue()||t.CancelledCheque){this.byId("canChqfileUploader").setValueState("None")}else{e=true;this.byId("canChqfileUploader").setValueState("Error")}if(this.byId("supplierAssessmentFileUploader").getValue()||t.SupplierAssessment){this.byId("supplierAssessmentFileUploader").setValueState("None")}else{e=true;this.byId("supplierAssessmentFileUploader").setValueState("Error")}return e},onInputChange:function(e,t){this.createModel.getData()[t]=e.getParameter("newValue");this.createModel.refresh},onSavePress:function(e){var s=this.createModel.getData();var a=this.getView().getModel("request").getData();s.VendorName=a.VendorName;s.Telephone=a.Telephone;s.VendorType=a.VendorType;s.VendorMail=a.VendorMail;s.BeneficiaryName=a.VendorName;s.GroupType=s.GroupType.join(",");var r=JSON.stringify(s);this.draft=true;i.show();var o=this.hardcodedURL+`/v2/odata/v4/catalog/VendorForm('${this.vendorId}')`;$.ajax({type:"PUT",contentType:"application/json",url:o,data:r,context:this,success:function(e,s,a){i.hide();t.success("Form data saved successfully",{onClose:()=>{this.changeStatus()}})}.bind(this),error:function(e,t,s){i.hide()}})},onSubmitPress:async function(e){var s=this;var a=await this._mandatCheck();if(!a){var r=this.createModel.getData();var o=this.getView().getModel("request").getData();var n=this.getView().getModel();s.otp=s.getOTP();s.otpTime=(new Date).getTime();var d={method:"GET",urlParameters:{vendorName:o.VendorName,subject:"OTP",content:`||OTP for submit vendor on-boarding form is ${s.otp}. | Do not share this with anyone. ImperialAuto will never telephone you to verify it.`,toAddress:o.VendorMail,ccAddress:""},success:function(e,t){s._enterOTP()},error:function(e){t.error("Failed to send OTP. Please try again.")}};n.callFunction("/sendEmail",d)}else{i.hide();if(a){t.information("Kindly fill all the required details")}}},sendEmailNotification:function(e,t,i,s){return new Promise((a,r)=>{let o;if(e==="Initiator"){o=`||Form is submitted by the supplier ${t} on ${s}. Approval pending at Purchase.`}else{let e=window.location.href.split("/index")[0].split(".onboarding")[0]+".onboarding.spfiorionboarding/index.html";o=`||Form is submitted by the supplier ${t} on ${s}. Approval pending at Purchase. Kindly submit and approve using below link.<br><br><a href=${e}>CLICK HERE</a>`}var n=this.getView().getModel();var d={method:"GET",urlParameters:{vendorName:e,subject:"Supplier Form",content:o,toAddress:i,ccAddress:""},success:function(e,t){console.log("Email sent successfully.");a(e)},error:function(e){console.log("Failed to send email.");r(e)}};n.callFunction("/sendEmail",d)})},getQualityEmails:async function(){var e=this.getView().getModel();return new Promise((t,i)=>{e.read("/AccessInfo",{filters:[new sap.ui.model.Filter("Access",sap.ui.model.FilterOperator.EQ,"Purchase")],success:function(e){var i=e.results.map(e=>e.email);t(i)},error:function(e){i(e)}})})},getPurchaseEmails:async function(){var e=this.getView().getModel();return new Promise((t,i)=>{e.read("/AccessInfo",{filters:[new sap.ui.model.Filter("Access",sap.ui.model.FilterOperator.EQ,"Purchase")],success:function(e){var i=e.results.map(e=>e.email);t(i)},error:function(e){i(e)}})})},_enterOTP:function(){var e=this;var s=sap.ui.getCore();let l=this.createModel.getData();var c=this.getView().getModel("request").getData();l.VendorName=c.VendorName;l.Telephone=c.Telephone;l.VendorType=c.VendorType;l.VendorMail=c.VendorMail;l.vendorId=c.vendorId;l.BeneficiaryName=c.VendorName;l.GroupType=l.GroupType.join(",");if(!this.oSubmitDialog){this.oSubmitDialog=new a({type:r.Message,title:"Enter the OTP Received ",content:[new d("submissionNote",{width:"100%",placeholder:"Enter OTP",liveChange:function(e){var t=e.getParameter("value");this.oSubmitDialog.getButtons()[0].setEnabled(t.length>=6)}.bind(this)})],buttons:[new o({type:n.Emphasized,text:"Submit",enabled:false,press:async function(){var e=(new Date).getTime();var a=e-this.otpTime;var r=s.byId("submissionNote").getValue();if(a<=3e5&&r===this.otp){i.show();l.Otp=r;if(l.RegistrationType==="Non BOM parts"){this.name="Purchase Team"}else{if(l.SupplierType==="Temporary"||l.SupplierType==="One Time"){this.name="Purchase Team"}else{this.name="Purchase Team"}}this.initiateName="Initiator";var o=JSON.stringify(l);var n=this.hardcodedURL+`/v2/odata/v4/catalog/VendorForm('${l.VendorId}')`;$.ajax({type:"PUT",contentType:"application/json",url:n,data:o,context:this,success:async function(e,i,s){var a=parseInt(e.d.modifiedAt.match(/\/Date\((\d+)\+\d+\)\//)[1]);var r=new Date(a);var o=r.toDateString();await this.sendEmailNotification(this.initiateName,e.d.VendorName,c.initiatedBy,o);try{var n=await this.getPurchaseEmails();for(const t of n){await this.sendEmailNotification(this.name,e.d.VendorName,t,o)}}catch(e){console.error("Error fetching Purchase emails: ",e)}t.success("Form submitted successfully",{onClose:()=>{this.changeStatus()}})}.bind(this),error:function(e,t,s){console.log("Error: ",e,t,s);i.hide()}});s.byId("submissionNote").setValue();this.oSubmitDialog.close()}else{s.byId("submissionNote").setValue();if(a>6e4){t.error("OTP has expired")}else{t.error("Incorrect OTP")}}}.bind(this)}),new o({text:"Resend OTP",press:function(){this.onSubmitPress();this.oSubmitDialog.close()}.bind(this)}),new o({type:n.Reject,text:"Cancel",press:function(){this.oSubmitDialog.close()}.bind(this)})]})}this.oSubmitDialog.open()},updateProductInfo:function(e){var t=this.productInfoTableModel.getData().rows;for(let s=0;s<t.length;s++){let a=t[s];let r=this.hardcodedURL+`/v2/odata/v4/catalog/ProductInfo(Vendor_VendorId='${e}',SrNo=${a.SrNo})`;let o=JSON.stringify(a);$.ajax({type:"PUT",contentType:"application/json",url:r,data:o,context:this,success:(e,t,s)=>{i.hide()},error:(e,t,s)=>{i.hide()}})}},onFileUploaderChange:function(e){var i=e.getSource();i.setUploadUrl(this.getView().getModel().sServiceUrl+"/Attachments");var s=i.getCustomData()[0].getKey();i.addHeaderParameter(new sap.ui.unified.FileUploaderParameter({name:"slug",value:this.vendorId+"/"+i.getValue()+"/"+s}));i.checkFileReadable().then(()=>{i.upload()},()=>{t.information("The file cannot be read. It may have changed.")})},onUploadComplete:function(e){if(e.getParameters().status!==201){t.error(JSON.parse(e.getParameters().responseRaw).error.message.value)}else{var i=e.getParameters().fileName;var s=e.getSource().getCustomData()[0].getKey();var a=this.createModel.getData();a[s]=i;this.createModel.setData(a);h.show("File "+i+" Attached successfully")}},onFileSizeExceded:function(e){t.error("File size exceeds the range of 5MB");e.getSource().setValueState("Error")},onAttachmentGet:function(e){var t=e.getSource().getCustomData()[0].getKey();i.show();setTimeout(()=>{var e=[new sap.ui.model.Filter("VendorId",sap.ui.model.FilterOperator.EQ,this.vendorId),new sap.ui.model.Filter("Venfiletype",sap.ui.model.FilterOperator.EQ,t)];var s=new sap.ui.model.Filter({filters:e,and:true});this.getView().getModel().read("/Attachments",{filters:[s],success:e=>{var t=e.results[0];var s=this.getView().getModel().sServiceUrl+"/Attachments(VendorId='"+t.VendorId+"',ObjectId='"+t.ObjectId+"')/$value";window.open(s,"_blank");i.hide()},error:()=>i.hide()})},1e3)},onMainCertificateChange:function(e){if(e.getParameter("selected")){this.createModel.setProperty("/MsmeMainCertificate","X")}else{this.createModel.setProperty("/MsmeMainCertificate","")}this.createModel.refresh(true)},onCertificationChange:function(e){var t=e.getParameter("selected");var i=e.getSource().getId();var s=i.split("--");var a=s[s.length-1];if(t){this.createModel.setProperty("/"+a,"X")}else{this.createModel.setProperty("/"+a,"")}this.createModel.refresh(true)},onMACEGreenChange:function(e){var t=e.getParameter("selected");if(t){this.createModel.setProperty("/"+MACEGreen,"X")}else{this.createModel.setProperty("/"+MACEGreen,"")}this.createModel.refresh(true)},getOTP:function(){var e=Math.floor(1e5+Math.random()*9e5).toString();return e},changeStatus:function(){var e=this.getView().getModel("request").getData();var t=this.createModel.getData();var i="";var s="";var a="";if(this.draft){if(e.Status==="INITIATED"||e.Status==="SAD"){this.draft=false;i="SAD"}}else{if(e.Status==="INITIATED"||e.Status==="SAD"||e.Status==="SRE-ROUTE"||e.Status==="RBP"){if(e.RegistrationType==="Non BOM parts"){i="SBS";s="1";a="Purchase"}else{if(t.SupplierType==="Temporary"||t.SupplierType==="One Time"){i="SBS";s="1";a="Purchase"}else{i="SBS";s="1";a="Purchase"}}}}var r=e;r.Status=i;r.VenLevel=s;r.VenApprovalPending=a;r.SupplierType=t.SupplierType;var o=JSON.stringify(r);var n=this.hardcodedURL+`/v2/odata/v4/catalog/VenOnboard(Vendor='${e.Vendor}',VendorId=${e.VendorId})`;$.ajax({type:"PUT",contentType:"application/json",url:n,data:o,context:this,success:function(e,t,i){if(i.status===200||i.status===204){console.log("Data upserted successfully.");window.location.reload()}}.bind(this),error:function(e,t,i){console.log("Upsert failed: ",i)}})},onAddGstPress:function(){var e=sap.ui.xmlfragment("sp.fiori.supplierform.fragment.Gst",this);this.getView().addDependent(e);sap.ui.getCore().byId("gstDialog").setModel(new s({}),"GstModel");e.open()},onGstSubmit:function(){i.show();var e=sap.ui.getCore().byId("gstDialog").getModel("GstModel").getData();var t=this.createModel.getData();t.GstNumber1=e.GstNumber1;t.GstFileName1=e.GstFileName1;t.Gst1Address1=e.Gst1Address1;t.Gst1Address2=e.Gst1Address2;t.GstNumber2=e.GstNumber2;t.GstFileName2=e.GstFileName2;t.Gst2Address1=e.Gst2Address1;t.Gst2Address2=e.Gst2Address2;t.GstNumber3=e.GstNumber3;t.GstFileName3=e.GstFileName3;t.Gst3Address1=e.Gst3Address1;t.Gst3Address2=e.Gst3Address2;t.GstNumber4=e.GstNumber4;t.GstFileName4=e.GstFileName4;t.Gst4Address1=e.Gst4Address1;t.Gst4Address2=e.Gst4Address2;t.GstNumber5=e.GstNumber5;t.GstFileName5=e.GstFileName5;t.Gst5Address1=e.Gst5Address1;t.Gst5Address2=e.Gst5Address2;this.createModel.refresh(true);i.hide();sap.ui.getCore().byId("gstDialog").destroy()},onDialogCancel:function(e){e.getSource().getParent().destroy()},customPanType:u.extend("Pan",{formatValue:function(e){return e},parseValue:function(e){return e},validateValue:function(e){var t=/^([a-zA-Z]){5}([0-9]){4}([a-zA-Z]){1}?$/;if(!e.match(t)){throw new p("'"+e+"' is not a valid PAN Number")}}}),customGstType:u.extend("Gst",{formatValue:function(e){return e},parseValue:function(e){return e},validateValue:function(e){var t=/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;if(!e.match(t)){throw new p("'"+e+"' is not a valid GST Number")}}}),customAccountType:u.extend("accountno",{formatValue:function(e){return e},parseValue:function(e){return e},validateValue:function(e){var t=/^[a-zA-Z0-9]+$/;if(!e.match(t)){throw new p("'"+e+"' is not a valid Account Number")}}})})});